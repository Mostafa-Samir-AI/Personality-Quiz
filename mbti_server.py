from flask import Flask, request, jsonify, send_from_directory
import json

app = Flask(__name__)

# تعريف أنواع الشخصيات وصفاتها
PERSONALITY_TYPES = {
    "ISTJ": {
        "name": "المفتش",
        "description": "أنت شخص منظم ومسؤول، تحب النظام والترتيب. تتميز بالواقعية والعملي، وتفضل العمل وفقاً للقواعد والإجراءات المحددة. أنت شخص موثوق به ويمكن الاعتماد عليه في المواقف الصعبة.",
        "strengths": ["الموثوقية", "الانضباط", "الواقعية", "الالتزام"],
        "weaknesses": ["الجمود", "التشدد", "قلة المرونة"],
        "careers": ["المحاسبة", "الإدارة", "الهندسة", "القانون"]
    },
    "ISFJ": {
        "name": "الحامي",
        "description": "أنت شخص دافئ وودود، تهتم بالآخرين وتحرص على راحتهم. تتميز بالولاء والمسؤولية، وتفضل البيئات المستقرة والمنظمة. أنت شخص حنون ومخلص، وتضع احتياجات الآخرين قبل احتياجاتك.",
        "strengths": ["الولاء", "الاهتمام بالآخرين", "الموثوقية", "الانضباط"],
        "weaknesses": ["التضحية المفرطة", "صعوبة قول لا", "التقليدية"],
        "careers": ["التمريض", "التدريس", "العمل الاجتماعي", "الإدارة"]
    },
    "INFJ": {
        "name": "المستشار",
        "description": "أنت شخص مبدع وحدسي، لديك رؤية عميقة للأمور. تهتم بالآخرين وتسعى لتحقيق التغيير الإيجابي في العالم. أنت شخص مثالي وخلاق، وتتميز بالقدرة على فهم الآخرين بشكل عميق.",
        "strengths": ["الإبداع", "الحدس", "الرؤية", "الاهتمام بالآخرين"],
        "weaknesses": ["المثالية المفرطة", "الحساسية", "الخصوصية المفرطة"],
        "careers": ["الاستشارة", "علم النفس", "الكتابة", "التدريس"]
    },
    "INTJ": {
        "name": "المهندس المعماري",
        "description": "أنت شخص استراتيجي ومبتكر، لديك رؤية مستقبلية واضحة. تتميز بالاستقلالية والتفكير المنطقي العميق. أنت شخص طموح وذكي، وتتميز بالقدرة على حل المشكلات المعقدة.",
        "strengths": ["الاستراتيجية", "الإبداع", "الاستقلالية", "المنطق"],
        "weaknesses": ["البرود العاطفي", "التعقيد المفرط", "الاستقلالية المفرطة"],
        "careers": ["الهندسة", "العلوم", "التخطيط الاستراتيجي", "البحث العلمي"]
    },
    "ISTP": {
        "name": "الحرفي",
        "description": "أنت شخص عملي ومغامر، تحب استكشاف كيفية عمل الأشياء. تتميز بالمرونة والتكيف مع المواقف المختلفة. أنت شخص هادئ ومستقل، وتتميز بالقدرة على حل المشكلات العملية.",
        "strengths": ["المرونة", "البراعة العملية", "الاستقلالية", "حل المشكلات"],
        "weaknesses": ["الانعزالية", "قلة التخطيط", "البرود العاطفي"],
        "careers": ["الهندسة", "الميكانيكا", "البرمجة", "الرياضة"]
    },
    "ISFP": {
        "name": "الملحن",
        "description": "أنت شخص فني وحساس، تحب الجمال والانسجام. تتميز بالتواضع والمرونة، وتفضل العيش في اللحظة الحالية. أنت شخص هادئ ومبدع، وتتميز بالقدرة على التعبير عن نفسك بشكل فني.",
        "strengths": ["الإبداع", "المرونة", "الحساسية", "الانسجام"],
        "weaknesses": ["التجنب", "الخصوصية المفرطة", "قلة التخطيط"],
        "careers": ["الفنون", "التصميم", "الموسيقى", "العلاج بالفن"]
    },
    "INFP": {
        "name": "المعالج",
        "description": "أنت شخص مثالي وخلاق، لديك قيم راسخة. تهتم بالآخرين وتسعى لتحقيق الانسجام والتوازن. أنت شخص حساس ومبدع، وتتميز بالقدرة على فهم مشاعر الآخرين.",
        "strengths": ["الإبداع", "الاهتمام بالآخرين", "المثالية", "المرونة"],
        "weaknesses": ["الحساسية المفرطة", "المثالية المفرطة", "التجنب"],
        "careers": ["الكتابة", "العلاج النفسي", "الفنون", "العمل الاجتماعي"]
    },
    "INTP": {
        "name": "المفكر",
        "description": "أنت شخص فضولي ومبتكر، تحب تحليل الأفكار والنظريات. تتميز بالمنطق والموضوعية في التفكير. أنت شخص مستقل وذكي، وتتميز بالقدرة على فهم النظريات المعقدة.",
        "strengths": ["المنطق", "الإبداع", "الاستقلالية", "الفضول"],
        "weaknesses": ["الانعزالية", "التعقيد المفرط", "قلة التنظيم"],
        "careers": ["البحث العلمي", "البرمجة", "الفلسفة", "العلوم"]
    },
    "ESTP": {
        "name": "المروج",
        "description": "أنت شخص نشيط ومغامر، تحب العمل والتجربة. تتميز بالمرونة والقدرة على التكيف مع المواقف المختلفة. أنت شخص اجتماعي ومغامر، وتتميز بالقدرة على حل المشكلات بشكل عملي.",
        "strengths": ["المرونة", "البراعة العملية", "الاجتماعية", "حل المشكلات"],
        "weaknesses": ["الاندفاعية", "قلة التخطيط", "الملل السريع"],
        "careers": ["المبيعات", "التسويق", "الرياضة", "ريادة الأعمال"]
    },
    "ESFP": {
        "name": "المؤدي",
        "description": "أنت شخص مرح واجتماعي، تحب المرح والتسلية. تتميز بالعفوية وحب الحياة. أنت شخص ودود ومبدع، وتتميز بالقدرة على جعل الآخرين يشعرون بالسعادة.",
        "strengths": ["الاجتماعية", "الإبداع", "المرح", "المرونة"],
        "weaknesses": ["الاندفاعية", "قلة التخطيط", "الحساسية للنقد"],
        "careers": ["الفنون", "التسويق", "العلاقات العامة", "التدريب"]
    },
    "ENFP": {
        "name": "البطل",
        "description": "أنت شخص متحمس ومبدع، تحب استكشاف الاحتمالات. تتميز بالحماس والتفاؤل. أنت شخص اجتماعي ومبدع، وتتميز بالقدرة على إلهام الآخرين.",
        "strengths": ["الإبداع", "الاجتماعية", "المرونة", "التحفيز"],
        "weaknesses": ["الاندفاعية", "قلة التنظيم", "الحساسية للنقد"],
        "careers": ["التسويق", "التدريب", "الإعلام", "ريادة الأعمال"]
    },
    "ENTP": {
        "name": "المخترع",
        "description": "أنت شخص ذكي ومبتكر، تحب النقاش والتحدي الفكري. تتميز بالفضول وحب الاستكشاف. أنت شخص اجتماعي ومبدع، وتتميز بالقدرة على حل المشكلات بشكل إبداعي.",
        "strengths": ["الإبداع", "الذكاء", "الاجتماعية", "حل المشكلات"],
        "weaknesses": ["الجدل المفرط", "قلة التنظيم", "الملل السريع"],
        "careers": ["ريادة الأعمال", "الاستشارة", "البحث العلمي", "التسويق"]
    },
    "ESTJ": {
        "name": "المشرف",
        "description": "أنت شخص عملي ومنظم، تحب القيادة والتخطيط. تتميز بالمسؤولية والالتزام بالقواعد. أنت شخص اجتماعي وموثوق به، وتتميز بالقدرة على تنظيم وإدارة الأمور.",
        "strengths": ["القيادة", "التنظيم", "الموثوقية", "الاجتماعية"],
        "weaknesses": ["التشدد", "قلة المرونة", "السيطرة المفرطة"],
        "careers": ["الإدارة", "القانون", "المالية", "التعليم"]
    },
    "ESFJ": {
        "name": "المقدم",
        "description": "أنت شخص ودود واجتماعي، تهتم بالآخرين. تتميز بالمسؤولية والتنظيم. أنت شخص حنون وموثوق به، وتتميز بالقدرة على خلق بيئة متناغمة.",
        "strengths": ["الاهتمام بالآخرين", "التنظيم", "الاجتماعية", "الموثوقية"],
        "weaknesses": ["الحساسية للنقد", "التقليدية", "التضحية المفرطة"],
        "careers": ["التدريس", "التمريض", "العمل الاجتماعي", "الإدارة"]
    },
    "ENFJ": {
        "name": "المعلم",
        "description": "أنت شخص كاريزمي وملهم، تحب مساعدة الآخرين. تتميز بالحكمة والقدرة على القيادة. أنت شخص اجتماعي ومبدع، وتتميز بالقدرة على إلهام وتوجيه الآخرين.",
        "strengths": ["القيادة", "الإلهام", "الاهتمام بالآخرين", "الاجتماعية"],
        "weaknesses": ["التضحية المفرطة", "الحساسية للنقد", "السيطرة المفرطة"],
        "careers": ["التدريس", "القيادة", "العلاج النفسي", "التدريب"]
    },
    "ENTJ": {
        "name": "القائد",
        "description": "أنت شخص قيادي وحاسم، تحب التخطيط الاستراتيجي. تتميز بالطموح والثقة بالنفس. أنت شخص اجتماعي وذكي، وتتميز بالقدرة على قيادة وتنظيم الآخرين.",
        "strengths": ["القيادة", "الاستراتيجية", "الذكاء", "الاجتماعية"],
        "weaknesses": ["السيطرة المفرطة", "البرود العاطفي", "التشدد"],
        "careers": ["الإدارة", "ريادة الأعمال", "السياسة", "القانون"]
    }
}

def calculate_personality_type(answers):
    # تحليل الإجابات لتحديد نوع الشخصية
    dimensions = {
        "EI": {"E": 0, "I": 0},
        "SN": {"S": 0, "N": 0},
        "TF": {"T": 0, "F": 0},
        "JP": {"J": 0, "P": 0}
    }

    # تحديث الأبعاد بناءً على الإجابات
    for answer in answers:
        if answer in ["التفاعل مع أكبر عدد من الناس", "قضاء الوقت مع الآخرين", "التفاعل المباشر مع الزملاء"]:
            dimensions["EI"]["E"] += 1
        elif answer in ["التحدث مع عدد قليل من الأصدقاء المقربين", "قضاء الوقت بمفردك", "العمل بشكل مستقل"]:
            dimensions["EI"]["I"] += 1
        elif answer in ["الواقع والحقائق الملموسة", "اتباع الأساليب المجربة والمثبتة", "التفاصيل والحقائق المحددة"]:
            dimensions["SN"]["S"] += 1
        elif answer in ["الاحتمالات والأفكار الجديدة", "استكشاف طرق جديدة ومبتكرة", "النظريات والمفاهيم العامة"]:
            dimensions["SN"]["N"] += 1
        elif answer in ["المنطق والتحليل", "الحقائق والمنطق", "العدالة والإنصاف"]:
            dimensions["TF"]["T"] += 1
        elif answer in ["المشاعر والقيم الشخصية", "العلاقات والمشاعر", "الانسجام والتفاهم"]:
            dimensions["TF"]["F"] += 1
        elif answer in ["التخطيط المسبق للأمور", "الالتزام بجدول زمني محدد", "إنجاز المهام قبل الموعد النهائي"]:
            dimensions["JP"]["J"] += 1
        elif answer in ["المرونة والتلقائية", "المرونة في تنظيم الوقت", "المرونة في إنجاز المهام"]:
            dimensions["JP"]["P"] += 1

    # تحديد نوع الشخصية
    personality_type = (
        ("E" if dimensions["EI"]["E"] > dimensions["EI"]["I"] else "I") +
        ("S" if dimensions["SN"]["S"] > dimensions["SN"]["N"] else "N") +
        ("T" if dimensions["TF"]["T"] > dimensions["TF"]["F"] else "F") +
        ("J" if dimensions["JP"]["J"] > dimensions["JP"]["P"] else "P")
    )

    return personality_type

@app.route('/')
def serve_quiz():
    return send_from_directory('.', 'mbti_quiz.html')

@app.route('/submit_quiz', methods=['POST'])
def submit_quiz():
    data = request.json
    answers = data.get('answers', [])
    
    if len(answers) != 12:  # يجب أن يتطابق مع عدد الأسئلة في الاختبار
        return jsonify({"error": "عدد الإجابات غير صحيح"}), 400
    
    personality_type = calculate_personality_type(answers)
    personality_info = PERSONALITY_TYPES.get(personality_type, {})
    
    return jsonify({
        "personality_type": f"{personality_type} - {personality_info.get('name', '')}",
        "description": personality_info.get('description', ''),
        "strengths": personality_info.get('strengths', []),
        "weaknesses": personality_info.get('weaknesses', []),
        "careers": personality_info.get('careers', [])
    })

if __name__ == '__main__':
    app.run(debug=True) 